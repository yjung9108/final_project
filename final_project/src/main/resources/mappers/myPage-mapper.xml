<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="myPageMapper">

	<resultMap id="memberResultSet" type="MyPage">
		<id column="member_no" property="memberNo"/>
		<result column="member_id" property="memberId"/>
		<result column="member_pwd" property="memberPwd"/>
		<result column="member_name" property="memberName"/>
		<result column="member_phone" property="memberPhone"/>
		<result column="member_createdt" property="memberCreateDt"/>
		<result column="member_link" property="memberLink"/>
		<result column="report_count" property="reportCount"/>
		<result column="member_status" property="memberStatus"/>
		<result column="member_profile" property="memberProfile"/>
		<result column="partner_join" property="partnerJoin"/>
		<result column="partner_name" property="partnerName"/>
		<result column="partner_intro" property="partnerIntro"/>
		<result column="follow_member_no" property="followMemberNo"/>
		
		<result column="project_no" property="projectNo"/>
		<result column="project_title" property="projectTitle"/>
		<result column="project_start_dt" property="projectStartDt"/>
		<result column="project_end_dt" property="projectEndDt"/>
		<result column="project_thum" property="projectThum"/>
		<result column="project_status" property="projectStatus"/>
		<result column="project_gprice" property="projectGPrice"/>
		
		<result column="oto_no" property="otoNo"/>
		<result column="oto_cat" property="otoCat"/>
		<result column="oto_title" property="otoTitle"/>
		<result column="oto_content" property="otoContent"/>
		<result column="oto_date" property="otoDate"/>
		<result column="oto_reply" property="otoReply"/>
		<result column="oto_re_reply" property="otoReReply"/>
		
		
		
	</resultMap>
	
	 <!--  
	<resultMap id="followMember" type="FollowMember">
		<id column="member_no" property="memberNo"/>
		<result column="follow_member_no" property="followMemberNo"/>
	</resultMap>
	-->
	  
	  
  	<select id="loginMember" resultMap="memberResultSet" parameterType="MyPage">
  		  
  		select
  		       member_no
  		     , member_id
  		     , member_pwd
  		     , member_name
  		     , member_phone
  		     , member_create_dt
  		     , member_link
  		     , report_count
  		     , member_status
  		     , member_profile
  		     , partner_join
  		     , partner_name
  		     , partner_intro
  		  from member
  		 where member_status IN ('Y', 'A')
  		   and member_id = #{memberId}
  		   and member_pwd = #{memberPwd}
  		
  	</select>
  	
  	<!-- 회원탈퇴 -->
  	<update id="deleteMember" parameterType="string">
  		update
  		       member
  		   set member_status = 'N'
  		     
  		 where member_id = #{memberId}
  	</update>
  	
  	
  	<!-- 팔로잉 목록카운트 -->
  	<select id="selectFollowListCount" resultType="_int">
		select 
		       count(*)
		  from member
		 where member_no in ( select 
		 							 follow_member_no
		                        from follow
		                       where member_no = #{ memberNo })
		    and member_status='Y'
		    and partner_join='Y'
	</select>
	
	<!-- 팔로우리스트 -->
	<select id="selectFollowList" resultMap="memberResultSet">
		select 
		        member_no
		      , member_id
		      , member_name
		      , member_profile
		      , partner_name
		      , partner_intro
		  from member
		 where member_no in ( select 
		   							 follow_member_no
		                        from follow
		                       where member_no = #{ memberNo })
		    and member_status='Y'
		    and partner_join='Y'
	</select>
	
	<!-- 회원정보수정 -->
  	<update id="updateMember" parameterType="MyPage">
  		update
  		        member
  		   set  member_phone = #{memberPhone}
  		      , member_profile = #{memberProfile}
  		 where member_id = #{memberId}
  	</update>
	
	
	<!-- 언팔 -->
	<delete id="unfollowMember" parameterType="MyPage" >
		delete 
		 	from follow
		   where member_no = #{memberNo}
		     and follow_member_no = #{followMemberNo}
		
	
	</delete>
	
	<!-- 팔로우 -->
	<insert id="followMember" parameterType="MyPage">
  		insert
  		  into follow
  		  (
  		    member_no
  		  , follow_member_no
  		  )
  		  values
  		  (
  		    #{memberNo}
  		  , #{followMemberNo}
  		  
  		  )
  	</insert>
	
	
	<!-- 팔로우멤버 (파트너)디테일정보 -->
  	<select id="partnerDetail" resultMap="memberResultSet" parameterType="MyPage">
		select 
		        member_no
		      , member_id
		      , member_name
		      , member_profile
		      , partner_name
		      , partner_intro
		      , partner_join
		  from member
		 where member_no = #{memberNo}
		   and member_status='Y'
		   and partner_join='Y'
	
	</select>
	
	<!-- 로그인한 유저의 멤버넘버로 해당 파트너 팔로우 유무체크 -->
	<!-- 값 거꾸로 넣었음 -->
	<select id="followCheck" resultType="_int">
		select 
		       count(*)
		  from follow
		 where member_no = #{followMemberNo}
		   and follow_member_no = #{memberNo}
	</select>
	
	<!-- 팔로워 수 -->
	<select id="followerCount" resultType="_int">
		select 
		       count(*)
		  from follow
		 where follow_member_no = #{memberNo}
	</select>
	
	<!-- 좋아요 목록카운트 -->
  	<select id="likeListCount" resultType="_int">
		select 
		       count(*)
		  from likey l
		  join project using(project_no)
         where l.member_no = #{memberNo}
		   and project_status='3'
	</select>
	
	
	<!-- 좋아요 리스트 -->
	<select id="likeList" resultMap="memberResultSet">
		select 
		        project_no
		      , project_title
		      , project_start_dt
		      , project_end_dt
		      , project_thum
		      , project_status
		      , project_gprice
		  from project
		  join likey using(project_no)
		 where project_no in ( select 
		   							 project_no
		                        from likey
		                       where member_no = #{memberNo})
		    and project_status='3'
		  order by project_end_dt asc
	</select>
  	
  	<!-- 나의문의 목록카운트 -->
  	<select id="myQueryListCount" resultType="_int">
		select 
		       count(*)
		  from oto
		 where member_no = #{memberNo}
	</select>
	
	
	<!-- 나의문의 리스트 -->
	<select id="myQueryList" resultMap="memberResultSet">
		select 
		        oto_no
		      , oto_cat
		      , oto_title
		      , oto_date
		      , oto_re_reply
		  from oto
		 where member_no = #{memberNo}
		 order by oto_no desc
	</select>
  	
  
  
</mapper>
